"use strict";(self.webpackChunkTicket_booking=self.webpackChunkTicket_booking||[]).push([[592],{4720:(x,v,r)=>{r.d(v,{m:()=>T});var s=r(8260),f=r(8305),U=r(5044);function d(n,u){const t=(0,U.m)(n)?n:()=>n,e=i=>i.error(t());return new f.y(u?i=>u.schedule(e,0,i):e)}var k=r(4499),c=r(4753),b=r(2835),S=r(7384);class g{constructor(u,t,e,i,l,a){this.email=u,this.id=t,this.dbUserId=e,this._token=i,this.type=l,this._tokenExpirationDate=a}getToken(){return!this._tokenExpirationDate||new Date>this._tokenExpirationDate?null:this._token}}var p=r(3556),w=r(4522),D=r(875);let T=(()=>{class n{constructor(t,e){this.http=t,this.router=e,this.user=new k.X(null),this.password=null,this.table_name="users.json"}checkEmail(){return this.http.get(s.N.apiUrl+this.table_name).pipe((0,c.U)(t=>{const e=[];for(const i in t)t.hasOwnProperty(i)&&e.push(Object.assign(Object.assign({},t[i]),{id:i}));return e}))}addUser(t){return this.http.post(s.N.apiUrl+this.table_name,t)}signUpUser(t,e){return this.http.post(s.N.signUpUrl+s.N.apikey,{email:t,password:e})}loginUser(t,e){return this.password=e,this.http.post(s.N.signInUrl+s.N.apikey,{email:t,password:e,returnSecureToken:!0}).pipe((0,b.K)(this.handleError),(0,S.b)(i=>{this.handleAuthentication(i.email,i.localId,i.idToken,+i.expiresIn)}))}autoLogin(){if(localStorage.getItem("user")){const t=JSON.parse(localStorage.getItem("user")),e=new g(t.email,t.id,t.dbUserId,t._token,t.type,new Date(t._tokenExpirationDate));if(e.getToken()){this.user.next(e);const i=new Date(t._tokenExpirationDate).getTime()-(new Date).getTime();this.autoLogout(i)}}}handleError(t){let e="An unkown error occure";if(!t.error||!t.error.error)return d(e);switch(t.error.error.message){case"EMAIL_NOT_FOUND":e="Email address not found";break;case"INVALID_PASSWORD":e="Invalid password";break;case"USER_DISABLED":e="Account disabled"}return d(e)}handleAuthentication(t,e,i,l){this.http.get(s.N.apiUrl+this.table_name).pipe((0,c.U)(a=>{const o=[];for(const h in a)a.hasOwnProperty(h)&&o.push(Object.assign(Object.assign({},a[h]),{id:h}));return o})).subscribe(a=>{let o=a.find(h=>h.email==t);if(o.password==this.password){const h=new Date((new Date).getTime()+1e3*l),m=new g(t,e,o.id,i,o.type,h);this.user.next(m),this.autoLogout(1e3*l),localStorage.setItem("user",JSON.stringify(m)),"admin"==o.type?this.router.navigate(["/admin"]):"user"==o.type&&this.router.navigate(["/"])}})}logout(){this.user.next(null),localStorage.removeItem("user"),this.expirationTimer&&clearTimeout(this.expirationTimer),this.expirationTimer=null}autoLogout(t){this.expirationTimer=setTimeout(()=>{this.logout()},t)}getUsers(){return this.http.get(s.N.apiUrl+this.table_name).pipe((0,c.U)(t=>{const e=[];for(const i in t)t.hasOwnProperty(i)&&e.push(Object.assign(Object.assign({},t[i]),{id:i}));return e}))}}return n.\u0275fac=function(t){return new(t||n)(p.LFG(w.eN),p.LFG(D.F0))},n.\u0275prov=p.Yz7({token:n,factory:n.\u0275fac,providedIn:"root"}),n})()}}]);